# 超声波聊天 - Chaos Chat

一个基于超声波通信的近距离聊天应用，使用Web Audio API实现18-19kHz频率的数据传输，支持公开和私密对话模式。

## ✨ 功能特性

### 🎯 核心功能
- **超声波探测**: 自动发现使用相同应用的附近用户
- **雷达界面**: 直观的圆形UI显示自己和周围用户
- **实时聊天**: 支持文字消息的实时传输
- **多人对话**: 支持多用户同时参与聊天
- **隐私模式**: 一键切换公开/私密对话，私密模式采用加密传输

### 🔧 技术特性
- **PWA应用**: 支持安装到桌面，离线可用
- **双频模式**: 高频模式(18.7/19.3 kHz)和低频模式(17.5/18.1 kHz)
- **自适应降级**: 信号质量差时自动切换到低频模式
- **错误恢复**: 支持CRC校验和重传机制
- **现代UI**: 响应式设计，支持移动端和桌面端

## 👀欢迎加入微信交流群
https://100.agitao.net/

![100个AI产品交流群](https://github.com/user-attachments/assets/c92c830c-5422-464d-a516-c86656a15188)

## 🚀 快速开始

### 直接使用
1. 打开 `index.html` 文件
2. 允许麦克风权限
3. 点击任意位置激活超声波功能
4. 等待发现附近用户

### 本地部署
```bash
# 启动简单HTTP服务器
python -m http.server 8000
# 或使用Node.js
npx serve .
# 访问 http://localhost:8000
```

### PWA安装
1. 在支持的浏览器中打开应用
2. 点击地址栏的"安装"按钮
3. 确认安装到桌面

## 🎮 使用指南

### 1. 初始设置
- **设置用户名**: 点击右上角设置按钮，输入您的用户名
- **调整音量**: 根据环境调整超声波发送音量
- **选择频率**: 根据设备支持情况选择高频或低频模式

### 2. 发现用户
- 确保自动发现功能已开启
- 应用会定期发送心跳信号
- 发现的用户会在雷达圆圈周围显示为彩色圆点
- 点击用户圆点可以邀请其加入聊天

### 3. 聊天功能
- **加入聊天**: 接受邀请或创建新的聊天室
- **发送消息**: 在输入框中输入文字，按回车或点击发送
- **切换隐私**: 点击🔓/🔒按钮切换公开/私密模式
- **邀请用户**: 点击👥按钮邀请更多用户加入

### 4. 隐私模式
- 私密模式下消息会被加密传输
- 只有拥有密钥的用户才能解密消息
- 切换到私密模式时会自动生成新的加密密钥
- 密钥会通过超声波分发给聊天室成员

## 🔬 技术实现

### 超声波通信
```javascript
// 频率配置
const config = {
    high: {
        freq0: 18700, // 0比特频率
        freq1: 19300, // 1比特频率
        bitRate: 40   // 比特率 (bps)
    },
    low: {
        freq0: 17500, // 低频模式
        freq1: 18100,
        bitRate: 10
    }
};
```

### 数据包格式
```
[同步头8字节] [载荷长度1字节] [载荷数据] [CRC校验1字节]
```

### 调制方式
- **2-FSK调制**: 使用两个不同频率表示0和1
- **Goertzel算法**: 用于频率检测和解调
- **AudioWorklet**: 实时音频处理，支持低延迟

### 加密算法
- **XOR加密**: 简单但有效的对称加密
- **密钥分发**: 通过超声波安全传输密钥
- **会话密钥**: 每次切换到私密模式生成新密钥

## 📱 浏览器兼容性

### 支持的浏览器
- ✅ Chrome 66+ (Android/Desktop)
- ✅ Safari 14+ (iOS/macOS)
- ✅ Firefox 76+ (Android/Desktop)
- ✅ Edge 79+ (Desktop)

### 注意事项
- **用户手势要求**: 首次使用需要用户点击以激活音频上下文
- **权限要求**: 需要麦克风权限进行超声波接收
- **硬件限制**: 设备扬声器和麦克风需要支持高频段
- **iOS特殊处理**: iOS设备在>19kHz频段可能有限制

## ⚙️ 配置选项

### 音频参数
```javascript
// 采样率配置
sampleRate: 48000

// 音量控制（0-1）
volume: 0.8

// 缓冲区大小
bufferSize: 4096
```

### 网络参数
```javascript
// 心跳间隔
heartbeatInterval: 3000ms

// 用户超时时间
userTimeout: 10000ms

// 最大载荷长度
maxPayloadLength: 32 bytes
```

## 🐛 故障排除

### 常见问题

**Q: 无法发现其他用户？**
A: 
- 确保麦克风权限已开启
- 检查设备音量和超声波音量设置
- 尝试切换到低频模式
- 确保设备距离在有效范围内（通常2-5米）

**Q: 消息发送失败？**
A:
- 检查网络连接和超声波状态指示器
- 尝试重新连接或刷新页面
- 确保消息长度不超过限制

**Q: 无法加入聊天室？**
A:
- 确保邀请方和接收方都在线
- 检查是否有冲突的聊天室
- 尝试重新发送邀请

**Q: 私密模式无法解密？**
A:
- 确保所有成员都收到了加密密钥
- 尝试重新切换隐私模式
- 检查超声波信号质量

### 性能优化

**信号质量差时的处理：**
1. 自动切换到低频模式
2. 增加重传次数
3. 降低比特率
4. 增强前向纠错

**电池优化：**
1. 智能心跳频率调整
2. 后台时降低活动
3. 缓存优化减少计算

## 🔒 安全考虑

### 隐私保护
- 所有通信仅在本地范围内进行
- 无需互联网连接，保护用户隐私
- 私密模式提供端到端加密
- 用户ID随机生成，不包含个人信息

### 安全建议
- 在公共场所使用时注意周围环境
- 定期清理聊天历史记录
- 避免在敏感环境中使用高功率模式
- 注意超声波可能对某些动物产生影响

## 📄 开源协议

本项目采用 MIT 协议开源，您可以自由使用、修改和分发。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目：

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启Pull Request

## 📞 技术支持

如果您在使用过程中遇到问题，可以：

1. 查看本README的故障排除部分
2. 在GitHub上提交Issue
3. 查看浏览器开发者工具的控制台输出

## 🔮 未来计划

- [ ] 支持文件传输
- [ ] 添加语音消息功能
- [ ] 实现群组管理功能
- [ ] 支持更多加密算法
- [ ] 优化信号质量和传输距离
- [ ] 支持更多语言

---

**注意**: 该应用仅用于技术演示和学习目的。在实际使用中请遵守当地法律法规，并注意保护个人隐私。 
